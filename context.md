Проект: Telegram чат-бот на TypeScript (Telegraf)

Контекст проекта (источник истины, не анализировать код):

1) Назначение
- Бот для Telegram, базовый функционал: команды `/start`, `/health`, а также echo для любого текстового сообщения.

2) Технологии и пакеты
- Язык: TypeScript, таргет Node.js >= 18.17, ESM-модули.
- Фреймворк бота: telegraf.
- Конфигурация окружения: dotenv.
- Запуск в разработке: tsx.
- Сборка: TypeScript (tsc) в каталог `dist`.
 - База данных: SQLite (better-sqlite3).

3) Структура
- `src/index.ts` — входная точка; инициализация dotenv; создание экземпляра `Telegraf`; реализация команд `/start`, `/health` и echo-хендлера; обработка ошибок; graceful shutdown в dev.
 - `src/db.ts` — инициализация SQLite, схема и функции логирования сообщений.

4) Команды npm
- `npm run dev` — запуск через tsx.
- `npm run build` — сборка tsc.
- `npm start` — запуск собранной версии из `dist`.

5) Переменные окружения
- `BOT_TOKEN` — токен Telegram-бота (обязательно).
- `NODE_ENV` — окружение (`development`/`production`).
- Пример значений приведён в файле `env.example` (если возможно, переименовать в `.env`).
 - `DATABASE_PATH` — путь к файлу базы SQLite (по умолчанию `data/bot.sqlite`).

6) Поведение
- `/start` — приветствие пользователя по имени.
- `/health` — ответ `OK`.
- Любое текстовое сообщение — ответ в формате `Echo: <текст>`.
 - Все входящие и исходящие сообщения логируются в таблицу `messages` SQLite.

7) Детали БД и логирования
- Таблица `messages`: поля `id`, `direction` ('in'|'out'), `chat_id`, `user_id`, `message_id`, `text`, `raw_json`, `created_at` (UTC, `datetime('now')`).
- Инициализация БД происходит при старте (`getDatabase()` в `src/index.ts`).
- Входящие сообщения логируются middleware (если в апдейте есть `message`).
- Исходящие — через обёртки над `ctx.reply` и `ctx.telegram.sendMessage`.

7) Замечания по окружению разработки
- Некоторые среды блокируют создание скрытых файлов (например, `.env.example`). В проекте лежит `env.example`; при необходимости его нужно переименовать в `.env`.

Эта запись является исчерпывающим контекстом для дальнейшей разработки без анализа файлов проекта.
